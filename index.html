function tracerBatiment(lat, lon) {
    const query = `
        [out:json][timeout:10];
        way["building"](around:80,${lat},${lon});
        out geom;
    `;

    fetch("https://overpass-api.de/api/interpreter", {
        method: "POST",
        body: query
    })
    .then(r => r.json())
    .then(data => {
        if (!data.elements || data.elements.length === 0) {
            alert("Aucun bâtiment trouvé autour de ce point.");
            return;
        }

        // Fonction pour calculer le centroïde d'un polygone
        function centroid(coords) {
            let latSum = 0, lonSum = 0;
            coords.forEach(c => {
                latSum += c.lat;
                lonSum += c.lon;
            });
            return {
                lat: latSum / coords.length,
                lon: lonSum / coords.length
            };
        }

        // Trouver le bâtiment le plus proche du point donné
        let meilleur = null;
        let meilleureDistance = Infinity;

        data.elements.forEach(bat => {
            const coords = bat.geometry;
            const c = centroid(coords);

            const d = Math.sqrt(
                Math.pow(c.lat - lat, 2) +
                Math.pow(c.lon - lon, 2)
            );

            if (d < meilleureDistance) {
                meilleureDistance = d;
                meilleur = bat;
            }
        });

        if (!meilleur) {
            alert("Impossible de déterminer le bâtiment le plus proche.");
            return;
        }

        // Tracer le bon bâtiment
        const coords = meilleur.geometry.map(p => [p.lat, p.lon]);

        const poly = L.polygon(coords, {
            color: "red",
            weight: 3,
            fillOpacity: 0.3
        }).addTo(map);

        map.fitBounds(poly.getBounds());
    })
    .catch(err => {
        console.error("Erreur Overpass:", err);
    });
}
