<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Carte des logements</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css">

    <style>
        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            height: 100vh;
            width: 100vw;
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<!-- üîµ TON CODE JAVASCRIPT COMMENCE ICI -->
<script>

// -------------------------
// Initialisation de la carte
// -------------------------
let map = L.map('map').setView([48.418827691419466, -71.06886684894563], 17);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    maxZoom: 20
}).addTo(map);

// -------------------------
// Afficher les coordonn√©es au clic
// -------------------------
map.on("click", function(e) {
    console.log("Coordonn√©es cliqu√©es :", e.latlng);
    alert("Coordonn√©es : " + e.latlng.lat + ", " + e.latlng.lng);
});

// -------------------------
// Fonction pour tracer le b√¢timent le plus proche
// -------------------------
function tracerBatiment(lat, lon) {
    const query = `
        [out:json][timeout:10];
        way["building"](around:80,${lat},${lon});
        out geom;
    `;

    fetch("https://overpass-api.de/api/interpreter", {
        method: "POST",
        body: query
    })
    .then(r => r.json())
    .then(data => {
        if (!data.elements || data.elements.length === 0) {
            alert("Aucun b√¢timent trouv√© autour de ce point.");
            return;
        }

        // Fonction pour calculer le centro√Øde d'un polygone
        function centroid(coords) {
            let latSum = 0, lonSum = 0;
            coords.forEach(c => {
                latSum += c.lat;
                lonSum += c.lon;
            });
            return {
                lat: latSum / coords.length,
                lon: lonSum / coords.length
            };
        }

        // Trouver le b√¢timent le plus proche du point donn√©
        let meilleur = null;
        let meilleureDistance = Infinity;

        data.elements.forEach(bat => {
            const coords = bat.geometry;
            const c = centroid(coords);

            const d = Math.sqrt(
                Math.pow(c.lat - lat, 2) +
                Math.pow(c.lon - lon, 2)
            );

            if (d < meilleureDistance) {
                meilleureDistance = d;
                meilleur = bat;
            }
        });

        if (!meilleur) {
            alert("Impossible de d√©terminer le b√¢timent le plus proche.");
            return;
        }

        // Tracer le bon b√¢timent
        const coords = meilleur.geometry.map(p => [p.lat, p.lon]);

        const poly = L.polygon(coords, {
            color: "red",
            weight: 3,
            fillOpacity: 0.3
        }).addTo(map);

        map.fitBounds(poly.getBounds());
    })
    .catch(err => {
        console.error("Erreur Overpass:", err);
    });
}

// -------------------------
// Tracer le b√¢timent du 725 Rue Jolliet
// -------------------------
tracerBatiment(48.418827691419466, -71.06886684894563);

</script>
<!-- üîµ TON CODE JAVASCRIPT FINIT ICI -->

</body>
</html>
